<%  bucket = AWS::S3::Bucket.new('shoobphoto') %>

<% s3object = AWS::S3::S3Object.new(bucket, "csvs/#{Export.last.file_path}") %>
      

<% @image_url = s3object.url_for(:read, :expires => 60.minutes, :use_ssl => true) %>

<div class="row">
<div class="col-sm-6">

<%= link_to 'Generate the latest CSV File of Orders', corder_export_path(Corder.first.id) %><br />

<% if Export.last.file_path.nil? %>
<a href="#" download class="btn btn-disabled btn-primary">The CSV is still being processed. Please refresh in a few minutes.</a>
<% else %>
<a href="<%= @image_url %>" download class="btn btn-primary">Download <%= Export.last.file_path %></a>
<% end %>
</div>
<div class="col-sm-6">
<%= form_tag('/corders/import/', multipart: true) do %>

  <%= file_field_tag :file %>
  <%= submit_tag "Import" %>
<% end %>
</div>
</div>

<table>
  <thead>
    <tr>
      <th></th> 
      <th>ID</th>
      <th>Date</th>
      <th>School</th>
      <th>First name</th>
      <th>Last name</th>
      <th>Phone</th>
      <th>Email</th>
      <th>Address</th>
      <th>City</th>
      <th>State</th>
      <th>Zip code</th>
      <th>Card type</th>
      <th>Card expires on</th>
      <th>Price</th>
      <th>Shipping address</th>
      <th>Shipping city</th>
      <th>Shipping zip</th>
      <th>Shipping state</th>
      <th>Processed</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @corders.each do |corder| %>
      <tr>
        <td><%= link_to "More info", corder_show_path(corder.id), remote: true, class: "btn btn-primary" %></td>
        <td><%= corder.id %></td>
        <td><%= corder.created_at %></td>
        <td><%= corder.schools %></td>
        <td><%= corder.first_name %></td>
        <td><%= corder.last_name %></td>
        <td><%= corder.phone %></td>
        <td><%= corder.email %></td>
        <td><%= corder.address %></td>
        <td><%= corder.city %></td>
        <td><%= corder.state %></td>
        <td><%= corder.zip_code %></td>
        <td><%= corder.card_type %></td>
        <td><%= corder.card_expires_on %></td>
        <td><%= corder.price %></td>
        <td><%= corder.shipping_address %></td>
        <td><%= corder.shipping_city %></td>
        <td><%= corder.shipping_zip %></td>
        <td><%= corder.shipping_state %></td>
        <td id="corder_<%= corder.id %>">

          <% if corder.processed? %>
          <%= render :partial => 'processed', :locals => {:corder => corder} %>
          <% else %>
          <%= render :partial => 'unprocessed', :locals => {:corder => corder} %>
          <% end %>
        </td>

      </tr>
    <% end %>
  </tbody>
</table>

<br>

