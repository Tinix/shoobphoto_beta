<%= form_tag(export_batch_path(@school.id), method: :get, remote: true) do %>
<div class="row">
    <div class="col-sm-7">
    </div>
     <div class="col-sm-1"><div class="">Batch:</div>

    </div>
    <div class="col-sm-3">
        <%= select_tag :operation, options_for_select(Student::Operations), class: "form-control", id: "input_student_grade" %>
    </div>

    <div class="col-1">
        <%= submit_tag "Submit", class: "btn btn-primary btn-submit" %>
    </div>

</div>

<table class="table table">
	<thead>
		<th>
		</th>
		<th>
			Student ID
		</th>
		<th>
			Name
		</th>
		<th>
			Teacher/Class
		</th>
		<th>
			Grade
		</th>

		<th>
			Edit
		</th>
		<th>
			Download
		</th>
		<th> 
			Print
		</th>

		<th> 
			<input type="checkbox" id="selectAll" value="selectAll"> Select All

		</th>
	</thead>
	<tbody>
<% @students.each do |student| %>

<tr id="student_<%= student.id %>" data-link="<%=  %>">
	<%= link_to export_show_path(student.id, :image => @image.id), remote: true do %>
		<td>
			<%= image_tag("#{@image.student_images.where(:student_id => student.id).last.index unless @image.student_images.where(:student_id => student.id).last.try(:index).nil?}", class: "img-rounded") %>
		</td>
		<td>
			<%= student.student_id %>
		</td>
		<td>
			<%= student.first_name %> <%= student.last_name %>
		</td>
		<td>
			<%= student.teacher %>
		</td>
		<td>
			<%= student.grade %>
		</td>

		<td> 
			<%= link_to "Edit", export_show_path(student.id, :image => @image.id), remote: true, class: "btn btn-custom" %>
		</td>
		<td>

			<% unless @image.student_images.where(:student_id => student.id).last.try(:image).nil? %>
		<%= link_to "Download", export_download_path(student.id, @image.id), class: "btn btn-custom"  %>
		<% else %>
		<button type="button" class="btn btn-danger" data-container="body" data-toggle="popover" data-placement="top" data-content="This student is missing an image for an ID card. Please upload a portrait." data-original-title="" title="">Download</button>
		<% end %>
	</td>

		<td>
			<% if @image.student_images.where(:student_id => student.id).last.try(:image_file_name).nil? %>
			<button type="button" class="btn btn-danger" data-container="body" data-toggle="popover" data-placement="top" data-content="This student is missing an image for an ID card. Please upload a portrait." data-original-title="" title="">Print</button>
			<% else %>
			<%= link_to "Print", export_types_path(student.id, @school.id, :image => @image.id), remote: true, class: "btn btn-custom" %>
			<% end %>
		</td>
		<td>
			<% unless @image.student_images.where(:student_id => student.id).last.try(:image_file_name).nil? %>
			<%= check_box_tag "student[student_ids][]", student.id %>
			<% end %>
 		 </td>
		<% end %>
	</tr>

<% end %>
</tbody>
</table>

<%= will_paginate @students %>
<% end %>
<script>
$('[data-toggle="popover"]').popover();

$('body').on('click', function (e) {
    $('[data-toggle="popover"]').each(function () {
        //the 'is' for buttons that trigger popups
        //the 'has' for icons within a button that triggers a popup
        if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
            $(this).popover('hide');
        }
    });
});

$('#selectAll').click(function() {
   if (this.checked) {
       $(':checkbox').each(function() {
           this.checked = true;                        
       });
   } else {
      $(':checkbox').each(function() {
           this.checked = false;                        
       });
   } 
});

$(".btn-submit").on("click", function() {
  $('#myModal').modal('show');
  $("#modal-window").html("<%= escape_javascript(render partial: 'loading_submit') %>"); 
});
</script>